# Data Flow Diagram

This diagram illustrates how data propagates through the system, from the initial file system scan to the user interface, and how updates flow back to the persistence layer.

```mermaid
flowchart TD
    subgraph Input [Data Sources]
        FS[File System]
        User[User Input]
    end

    subgraph Processing [Transformation & Logic]
        Scanner[FileOrganizer.scan_directory]
        Enricher[CoreApp Enrichment Loop]
        Filter[DataProcessor Filtering]
        Sort[PDFSortFilterProxyModel]
    end

    subgraph Storage [Persistence]
        RawDF[Raw DataFrame]
        MasterDF[Master Enriched DataFrame]
        DB[(SQLite History.db)]
    end

    subgraph Output [Presentation]
        View[PDFTableView]
        MetaForm[MetadataView]
    end

    %% Flow: Scanning
    FS -->|Iterate Files| Scanner
    Scanner -->|Create Dicts| RawDF
    RawDF -->|Pass to| Enricher
    
    DB -->|Select Tags/Notes| Enricher
    Enricher -->|Merge Data| MasterDF
    
    MasterDF -->|Set Model| Sort
    Sort -->|Filter/Sort| View

    %% Flow: Editing
    User -->|Edit Metadata| MetaForm
    MetaForm -->|Signal: tags, notes| Enricher
    Enricher -->|Update Row| MasterDF
    Enricher -->|Insert/Update| DB
    MasterDF -->|Refresh| View

    %% Flow: Organizing
    User -->|Action: Rename/Move| Scanner
    Scanner -->|shutil.move| FS
    Scanner -->|Update Path| MasterDF
    Scanner -->|Log Operation| DB
```

## Data States

1.  **Raw State**: `[{'original_path': 'C:/...', 'filename': 'doc.pdf'}]`
    *   Generated by `FileOrganizer`.
2.  **Enriched State**: Raw + `{'tags': 'invoice', 'notes': 'paid'}`
    *   Merged in `CoreApp` using data from `SQLite`.
3.  **View State**: Enriched State filtered by `Regex` search.
    *   Managed by `QSortFilterProxyModel`.
